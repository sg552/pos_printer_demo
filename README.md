小票打印机/热敏打印机 - (爱宝 A8007) 打印机的介绍，编程方式和安装

2017-11-23 10:13
访问量: 24

分类： 技术
参考： 制作通用打印机小票程序 
我们的一个项目中，设计到了 餐饮系统。

餐饮系统用的比较多的，是小票打印机。往往用在后厨，让后厨师傅看到了出菜。

也会用在前台，打印小票，作为预结单据。

虽然用触摸屏可以替代，但是触摸屏的特点是造价昂贵，屏幕在1000-2000元， 整机大概在 3000以上。

小票打印机，最贵的 三口打印机（网口，USB， 串口电话线）也就是400块。

所以，小票打印机还是有很大市场的。

这个打印机的用法跟其他打印机不同：

1. 有两种打印方式：

1.1 本地打印机，可以根据windows的系统来打印。 网页上是啥，就可以打印出啥来。特别方便。 前提是需要在windows上安装驱动程序。

1.2 非本地（网口/USB口打印机）， 只能通过socket通讯来打印。  好处是不需要驱动。非常方便

所有的小票/热敏打印机，无论是58宽度，还是80宽度，无论是啥品牌，都是一样的。

都遵循着 EPSON 的ESC POS打印机的 编程规范来的。具体见：  http://siwei.me/system/resources/W1siZiIsIjIwMTcvMTEvMjMvMThfNDNfMzhfOTUzXzU4Xy5wZGYiXV0/58%E4%B8%AD%E6%96%87%E6%97%A0%E7%BA%BF%E7%83%AD%E6%95%8F%E6%89%93%E5%8D%B0%E6%9C%BA%E8%AF%B4%E6%98%8E%E4%B9%A6.pdf

基本上，都是通过使用（原生的，不是websocket） socket 来发送请求。实现打印， 切纸，等功能。 

socket 端口统一都是 9100.  下面是入门：

require 'socket'

s = TCPSocket.new('192.168.1.181', 9100);

# 打印 普通的字符串。
s.write "hihihi"
puts s.read(5)

# 打印3个换行。 
s.write "hihihi\n\n\n"  
# 换两行并切纸 ，但是慎用，可能会引起打印机死机。  TODO： 试试Write(0x1b,0x69) 或 Write(0x1d,0x76,0x49) 或 Write(0x1d,0x56,0x42,0x00)
s.write "\x0a\x0a\x1d\x56\x00"  
（参考： http://www.360doc.com/content/11/1101/10/8005503_160738911.shtml    1d 56 00）

# 以下高级功能，使用 EPSON 的ESC POS打印机函数

# 加粗
client.write "\x1B\x21\x08  bold ..."

# 倍高
client.write "\x1B\x21\x10  2x height..."

# 倍宽
client.write "\x1B\x21\x20  2x width...\n"

# 倍宽, 倍高
client.write "\x1B\x21\x30 2x width, height..."


s.close
这里需要注意的是，任何内容，都要查看 “编程手册”来。例如， 字体2x宽是 20, 2x高是 10, 那么又是倍宽，又是倍高，就要 \x30 。  这个是根据手册中看到的（2进制数字，8位的话，4,5,6位都是1 才行。通过二进制到16进制的在线转换，就可以了，点击这里：http://tool.oschina.net/hexconvert/）

在“编程手册”中，要注意这么几个点：

1. 选择字符大小：   GS ! n 

2. 选择对齐方式：  ESC a n

3. 选择字体： ESC M n

4. 选择打印模式：  ESC ! n  （加粗，加高，加宽，下划线等）

5. 设置左边距:  GS L nL nH

关于小票打印机的安装和调试：

安装： 

1. 根据网络打印机提供的软件， 设置这些打印机的IP，成为固定的。（这一步往往需要打印机跟电脑用网线直连，具体见说明书）

2. 要把小票打印机跟 要跟它沟通的设备（例如电脑）放在同一局域网

调试：

1. 按钮 feed 表示出纸，

2. 当feed与paper键同时变红（不闪烁）时，表示缺纸

3. 放纸时，那个纸筒中间的小棍子，不用实打实的放在那里。 很宽松的一扔就行，不会影响打印机的出纸的。

4. 关机后， 按住feed, 不放，同时开电源，2秒后松手， 打印机会打印自动检测的纸片

5. 长按feed 20秒，回到初始状态。

6. 如果 客户端通过socket发送给打印机命令，打印机无法识别或者出错时，会  FEED, PAPER 同时红色闪烁，大约5秒闪一次，一次闪两下。

7. 调试时，建议电脑跟打印机挨着。

8. 注意： 各种命令要放在每一行的行首，才会被识别为命令。 
